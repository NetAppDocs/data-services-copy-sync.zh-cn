---
sidebar: sidebar 
permalink: task-installing-gcp.html 
keywords: data broker, install, gcp, google, networking, permissions, regions, install data broker in gcp, install in gcp, deploy in gcp, deploy data broker in gcp, install data broker in google, install in google, deploy in google, deploy data broker in google, networking requirements, port, ports, 443, port 443, ntp, network time protocol, gcp data broker, service account 
summary: 创建新的数据代理时，选择 Google Cloud Data Broker 选项以在 VPC 中的新虚拟机实例上部署数据代理软件。  NetApp Copy and Sync将指导您完成安装过程，但此页面上重复了要求和步骤，以帮助您做好安装准备。 
---
= 在 Google Cloud 中为NetApp Copy and Sync创建新的数据代理
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
为NetApp Copy and Sync创建新的数据代理组时，请选择 Google Cloud Platform 在 Google Cloud VPC 中的新虚拟机实例上部署数据代理软件。  NetApp Copy and Sync将指导您完成安装过程，但此页面上重复了要求和步骤，以帮助您做好安装准备。

您还可以选择在云端或本地的现有 Linux 主机上安装数据代理。link:task-installing-linux.html["了解更多"] 。



== 支持的 Google Cloud 区域

支持所有地区。



== Root权限

数据代理软件在 Linux 主机上自动以 root 身份运行。以 root 身份运行是数据代理操作的必要条件。例如，挂载共享。



== 网络要求

* 数据代理需要出站互联网连接，以便它可以通过端口 443 轮询复制和同步任务。
+
当 Copy and Sync 在 Google Cloud 中部署数据代理时，它会创建一个安全组来启用所需的出站通信。

+
如果需要限制出站连接，请参阅link:reference-networking.html["数据代理联系的端点列表"]。

* NetApp建议配置源、目标和数据代理以使用网络时间协议 (NTP) 服务。三个组件之间的时间差不应超过5分钟。




== 在 Google Cloud 中部署数据代理所需的权限

确保部署数据代理的 Google Cloud 用户具有以下权限：

[source, yaml]
----
- compute.networks.list
- compute.regions.list
- deploymentmanager.deployments.create
- deploymentmanager.deployments.delete
- deploymentmanager.operations.get
- iam.serviceAccounts.list
----


== 服务帐户所需的权限

部署数据代理时，您需要选择具有以下权限的服务帐户：

[source, yaml]
----
- logging.logEntries.create
- resourcemanager.projects.get
- storage.buckets.get
- storage.buckets.list
- storage.objects.create
- storage.objects.delete
- storage.objects.get
- storage.objects.getIamPolicy
- storage.objects.list
- storage.objects.setIamPolicy
- storage.objects.update
- iam.serviceAccounts.signJwt
- pubsub.subscriptions.consume
- pubsub.subscriptions.create
- pubsub.subscriptions.delete
- pubsub.subscriptions.list
- pubsub.topics.attachSubscription
- pubsub.topics.create
- pubsub.topics.delete
- pubsub.topics.list
- pubsub.topics.setIamPolicy
- storage.buckets.update
- cloudkms.cryptoKeys.list
- cloudkms.keyRings.list
----
注：

. 仅当您计划设置数据代理以使用外部 HashiCorp 保险库时才需要“iam.serviceAccounts.signJwt”权限。
. 仅当您计划在从 Google Cloud Storage 到另一个云存储位置的同步关系上启用连续同步设置时，才需要“pubsub.*”和“storage.buckets.update”权限。link:task-creating-relationships.html#settings["了解有关持续同步选项的更多信息"] 。
. 仅当您计划在目标 Google Cloud Storage 存储桶上使用客户管理的 KMS 密钥时，才需要“cloudkms.cryptoKeys.list”和“cloudkms.keyRings.list”权限。




== 创建数据代理

有几种方法可以创建新的数据代理。以下步骤描述了在创建同步关系时如何在 Google Cloud 中安装数据代理。

.步骤
. link:task-login-copyandsync.html["登录以复制和同步"] 。
. 选择*创建新同步*。
. 在*定义同步关系*页面上，选择源和目标，然后选择*继续*。
+
完成这些步骤，直到到达*数据经纪人组*页面。

. 在*数据经纪人组*页面上，选择*创建数据经纪人*，然后选择*Google Cloud Platform*。
+
image:screenshot-google.png["数据代理页面的屏幕截图，可让您在 AWS、Azure、Google Cloud 和 On-Prem 数据代理之间进行选择。"]

. 输入数据代理的名称并选择*继续*。
. 如果出现提示，请使用您的 Google 帐户登录。
+
该表单由 Google 拥有并托管。您的凭据未提供给NetApp。

. 选择一个项目和服务帐户，然后选择数据代理的位置，包括是否要启用或禁用公共 IP 地址。
+
如果您没有启用公共 IP 地址，那么您需要在下一步中定义代理服务器。

+
image:screenshot_data_broker_gcp.png["显示在 Google Cloud 中部署数据代理所需信息的屏幕截图。"]

. 如果 VPC 中的互联网访问需要代理，请指定代理配置。
+
如果需要代理才能访问互联网，则代理必须位于 Google Cloud 中并使用与数据代理相同的服务帐户。

. 一旦数据代理可用，请在复制和同步中选择*继续*。
+
该实例大约需要 5 到 10 分钟才能部署。您可以从复制和同步中监控进度，当实例可用时会自动刷新。

. 完成向导中的页面以创建新的同步关系。


.结果
您已在 Google Cloud 中部署了数据代理并创建了新的同步关系。您可以将此数据代理与其他同步关系一起使用。



== 提供在其他 Google Cloud 项目中使用存储桶的权限

当您创建同步关系并选择 Google Cloud Storage 作为源或目标时，复制和同步可让您从数据代理的服务帐户有权使用的存储桶中进行选择。默认情况下，这包括与数据代理服务帐户位于同一项目中的存储桶。但是如果您提供所需的权限，您可以从其他项目中选择存储桶。

.步骤
. 打开 Google Cloud Platform 控制台并加载 Cloud Storage 服务。
. 选择您想要用作同步关系中的源或目标的存储桶的名称。
. 选择*权限*。
. 选择“*添加*”。
. 输入数据代理的服务帐户的名称。
. 选择提供以下功能的角色<<服务帐户所需的权限,与上面显示的权限相同>>。
. 选择*保存*。


.结果
当您设置同步关系时，您现在可以选择该存储桶作为同步关系中的源或目标。



== 有关数据代理虚拟机实例的详细信息

复制和同步使用以下配置在 Google Cloud 中创建数据代理。

Node.js 兼容性:: v21.2.0
机器类型:: n2-标准-4
虚拟 CPU:: 4
RAM:: 15 GB
操作系统:: Rocky Linux 9.0
磁盘大小和类型:: 20 GB 硬盘 pd-标准

