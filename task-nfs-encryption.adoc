---
sidebar: sidebar 
permalink: task-nfs-encryption.html 
keywords: encryption, in flight, data in flight, in-flight, data-in-flight, nfs, initiator, listener, port 
summary: 如果您的企业有严格的安全策略，请使用动态数据加密在不同网络中的 NFS 服务器之间同步数据。 
---
= 使用NetApp Copy and Sync 中的数据传输加密同步 NFS 数据
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
如果您的企业有严格的安全策略，您可以使用NetApp Copy and Sync 中的数据传输加密来同步 NFS 数据。此功能支持从一个 NFS 服务器到另一个 NFS 服务器以及从Azure NetApp Files到Azure NetApp Files。

例如，您可能希望在位于不同网络中的两个 NFS 服务器之间同步数据。或者您可能需要跨子网或区域安全地传输Azure NetApp Files上的数据。



== 数据传输加密的工作原理

当 NFS 数据在两个数据代理之间通过网络发送时，数据传输加密会对其进行加密。下图显示了两个 NFS 服务器和两个数据代理之间的关系：

image:diagram_nfs_encryption.gif["显示两个 NFS 服务器和两个数据代理的图表。数据从源 NFS 服务器流向源数据代理，此时数据被加密。然后将数据发送到目标数据代理，然后发送到目标 NFS 服务器。"]

一个数据代理充当_发起者_。当需要同步数据时，它会向另一个数据代理（即_监听器_）发送连接请求。该数据代理在端口 443 上监听请求。如果需要，您可以使用其他端口，但请务必检查该端口未被其他服务使用。

例如，如果您将数据从本地 NFS 服务器同步到基于云的 NFS 服务器，则可以选择哪个数据代理侦听连接请求以及哪个数据代理发送连接请求。

动态加密的工作原理如下：

. 创建同步关系后，发起者将与其他数据代理建立加密连接。
. 源数据代理使用 TLS 1.3 加密来自源的数据。
. 然后，它通过网络将数据发送到目标数据代理。
. 目标数据代理在将数据发送给目标之前对其进行解密。
. 初始复制后，复制和同步每 24 小时同步一次任何更改的数据。如果有数据需要同步，则该过程从发起者与其他数据代理建立加密连接开始。
+
如果您希望更频繁地同步数据，link:task-managing-relationships.html#change-the-settings-for-a-sync-relationship["您可以在创建关系后更改时间表"] 。





== 支持的NFS版本

* 对于 NFS 服务器，NFS 版本 3、4.0、4.1 和 4.2 支持数据传输加密。
* 对于Azure NetApp Files，NFS 版本 3 和 4.1 支持数据传输加密。




== 代理服务器限制

如果您创建加密同步关系，则加密数据将通过 HTTPS 发送，并且无法通过代理服务器路由。



== 入门所需

请确保具备以下条件：

* 两个 NFS 服务器link:reference-requirements.html["源和目标要求"]或两个子网或区域中的Azure NetApp Files。
* 服务器的 IP 地址或完全限定域名。
* 两个数据代理的网络位置。
+
您可以选择现有的数据代理，但它必须充当发起者。监听器数据代理必须是一个新的数据代理。

+
如果要使用现有的数据代理组，则该组必须只有一个数据代理。加密同步关系不支持组中的多个数据代理。

+
如果您尚未部署数据代理，请查看数据代理要求。由于您有严格的安全策略，请务必检查网络要求，其中包括来自端口 443 的出站流量和link:reference-networking.html["互联网端点"]数据经纪人联系的。

+
** link:task-installing-aws.html["检查 AWS 安装"]
** link:task-installing-azure.html["查看 Azure 安装Review Azure installation"]
** link:task-installing-gcp.html["检查 Google Cloud 安装"]
** link:task-installing-linux.html["检查 Linux 主机安装"]






== 使用数据传输加密同步 NFS 数据

在两个 NFS 服务器之间或Azure NetApp Files之间创建新的同步关系，启用动态加密选项，然后按照提示进行操作。

.步骤
. link:task-login-copyandsync.html["登录以复制和同步"] 。
. 选择*创建新同步*。
. 将 *NFS 服务器* 拖放到源位置和目标位置，或将 * Azure NetApp Files* 拖放到源位置和目标位置，然后选择 *是* 以启用数据传输加密。
. 按照提示创建关系：
+
.. *NFS 服务器*/* Azure NetApp Files*：选择 NFS 版本，然后指定新的 NFS 源或选择现有服务器。
.. *定义数据代理功能*：定义哪个数据代理在端口上监听连接请求以及哪个数据代理启动连接。根据您的网络要求做出选择。
.. *数据代理*：按照提示添加新的源数据代理或选择现有的数据代理。
+
请注意以下事项：

+
*** 如果要使用现有的数据代理组，则该组必须只有一个数据代理。加密同步关系不支持组中的多个数据代理。
*** 如果源数据代理充当监听器，那么它必须是一个新的数据代理。
*** 如果您需要新的数据代理，Copy and Sync 会提示您安装说明。您可以在云中部署数据代理，也可以为您自己的 Linux 主机下载安装脚本。


.. *目录*：通过选择所有目录或向下钻取并选择子目录来选择要同步的目录。
+
选择“*过滤源对象*”来修改定义如何在目标位置同步和维护源文件和文件夹的设置。

+
image:screenshot_directories.gif["屏幕截图显示了选择顶级目录、向下钻取并选择过滤源对象选项的选项。"]

.. *目标 NFS 服务器*/*目标Azure NetApp Files*：选择 NFS 版本，然后输入新的 NFS 目标或选择现有服务器。
.. *目标数据代理*：按照提示添加新的源数据代理或选择现有的数据代理。
+
如果目标数据代理充当监听器，那么它必须是一个新的数据代理。

+
以下是目标数据代理作为监听器时的提示示例。注意指定端口的选项。

+
image:screenshot_nfs_encryption_listener.gif["屏幕截图显示了在侦听器数据代理上指定端口的选项。"]

.. *目标目录*：选择顶级目录，或向下钻取以选择现有子目录或在导出中创建新文件夹。
.. *设置*：定义如何在目标位置同步和维护源文件和文件夹。
.. *审核*：审核同步关系的详细信息，然后选择*创建关系*。
+
image:screenshot_nfs_encryption_review.gif["显示审核屏幕的屏幕截图。它显示 NFS 服务器、数据代理以及每个服务器的网络信息。"]





.结果
复制和同步开始创建新的同步关系。完成后，选择*在仪表板中查看*以查看有关新关系的详细信息。
